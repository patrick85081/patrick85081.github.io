<!doctype html><html lang=zh-tw><head><title>IIS 使用 LocalDB 問題 // 派翠克技術手札</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Patrick"><meta name=description content="開發時候使用LocalDB使用得很順手，因此將網站放到本機的IIS時，也會想要沿用開發時候使用的LocalDb，原本以為是很單純的一件事，沒想到後面有這麼多的問題。"><link rel=stylesheet href=https://patrick85081.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css><meta name=twitter:card content="summary"><meta name=twitter:title content="IIS 使用 LocalDB 問題"><meta name=twitter:description content="開發時候使用LocalDB使用得很順手，因此將網站放到本機的IIS時，也會想要沿用開發時候使用的LocalDb，原本以為是很單純的一件事，沒想到後面有這麼多的問題。"><meta property="og:title" content="IIS 使用 LocalDB 問題"><meta property="og:description" content="開發時候使用LocalDB使用得很順手，因此將網站放到本機的IIS時，也會想要沿用開發時候使用的LocalDb，原本以為是很單純的一件事，沒想到後面有這麼多的問題。"><meta property="og:type" content="article"><meta property="og:url" content="https://patrick85081.github.io/posts/2021-05-07-iis-localdb/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-07T23:28:13+08:00"><meta property="article:modified_time" content="2021-05-07T23:28:13+08:00"></head><body><header class=app-header><a href=https://patrick85081.github.io/><img class=app-header-avatar src=/avatar.png alt=Patrick></a><h1>派翠克技術手札</h1><nav class=app-header-menu><a class=app-header-menu-item href=/>首頁</a>
-
<a class=app-header-menu-item href=/tags/>標籤</a>
-
<a class=app-header-menu-item href=/search/>文章搜尋</a></nav><p>這裡是派翠克的技術手札</p><div class=app-header-social><a href=https://github.com/patrick85081 target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=/index.xml target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-rss"><title>Rss</title><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a><a href=mailto:patrick85081@gmail.com target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail"><title>聯絡我</title><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>IIS 使用 LocalDB 問題</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-05-07, Friday</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>1 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://patrick85081.github.io/tags/localdb/>LocalDB</a></div></div></header><div class=post-content><p>開發時候使用LocalDB使用得很順手，因此將網站放到本機的IIS時，也會想要沿用開發時候使用的LocalDb，原本以為是很單純的一件事，沒想到後面有這麼多的問題。</p><h1 id=當iis下-直接使用-localdb出現-local-db-runtime-error>當IIS下 直接使用 LocalDB，出現 Local DB Runtime Error</h1><p>出現以下錯誤</p><blockquote><p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 50 - Local Database Runtime error occurred. Cannot create an automatic instance. See the Windows Application event log for error details.</p></blockquote><ul><li>解決方法<br>修改 <code>C:\Windows\System32\inetsrv\config\applicationHost.config</code> 檔案
將 <code>loadUserProfile</code> 和 <code>setProfileEnvironment</code> 都改成 <code>true</code></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;applicationPoolDefaults&gt;</span>
	<span style=color:#75715e>&lt;!-- 省略 --&gt;</span>
	<span style=color:#f92672>&lt;processModel</span> 
		<span style=color:#a6e22e>identityType=</span><span style=color:#e6db74>&#34;ApplicationPoolIdentity&#34;</span> 
		<span style=color:#a6e22e>loadUserProfile=</span><span style=color:#e6db74>&#34;true&#34;</span> 
		<span style=color:#a6e22e>setProfileEnvironment=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>/&gt;</span>
	<span style=color:#75715e>&lt;!-- 省略 --&gt;</span>
<span style=color:#f92672>&lt;/applicationPoolDefaults&gt;</span>
</code></pre></div><h1 id=iis-上的網站可以正常執行但是連的是另一個資料庫>IIS 上的網站可以正常執行，但是連的是另一個資料庫</h1><p>因為 IIS 是使用另一個使用者執行，但是localDB資料庫有分使用者</p><ul><li>解法
建立共享的 LocalDB 個體</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmd data-lang=cmd>sqllocaldb i // 查看目前有哪些 localdb 個體

// 請參照以下流程
sqllocaldb share MSSQLLocalDB MSSQLLocalDBShared
sqllocaldb stop MSSQLLocalDBShared
sqllocaldb start MSSQLLocalDBShared
</code></pre></div><p>修改連線字串為 <code>(localdb)\.\MSSQLLocalDBShared</code>就可以連線</p><h1 id=iis-沒有權限使用-localdb-共享的個體>IIS 沒有權限使用 LocalDB 共享的個體</h1><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> LOGIN [IIS APPPOOL<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#f92672>&lt;</span>Your <span style=color:#66d9ef>User</span><span style=color:#f92672>&gt;</span>] <span style=color:#66d9ef>FROM</span> WINDOWS;
<span style=color:#66d9ef>EXEC</span> sp_addsrvrolemember N<span style=color:#e6db74>&#39;IIS APPPOOL\&lt;Your User&gt;&#39;</span>, sysadmin;
</code></pre></div></div><div class=post-footer></div></article></main></body></html>
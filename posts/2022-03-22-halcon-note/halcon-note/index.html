<!doctype html><html lang=zh-tw><head><title>Halcon 常用的Function // 派翠克技術手札</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Patrick"><meta name=description content="這裡記錄一下，常用到的一些Halcon影像處理方法"><link rel=stylesheet href=https://patrick85081.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Halcon 常用的Function"><meta name=twitter:description content="這裡記錄一下，常用到的一些Halcon影像處理方法"><meta property="og:title" content="Halcon 常用的Function"><meta property="og:description" content="這裡記錄一下，常用到的一些Halcon影像處理方法"><meta property="og:type" content="article"><meta property="og:url" content="https://patrick85081.github.io/posts/2022-03-22-halcon-note/halcon-note/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-22T22:18:52+08:00"><meta property="article:modified_time" content="2022-03-22T22:18:52+08:00"></head><body><header class=app-header><a href=https://patrick85081.github.io/><img class=app-header-avatar src=/avatar.png alt=Patrick></a><h1>派翠克技術手札</h1><nav class=app-header-menu><a class=app-header-menu-item href=/>首頁</a>
-
<a class=app-header-menu-item href=/tags/>標籤</a>
-
<a class=app-header-menu-item href=/search/>文章搜尋</a></nav><p>這裡是派翠克技術手札</p><div class=app-header-social><a href=https://github.com/patrick85081 target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Halcon 常用的Function</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-03-22</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=https://patrick85081.github.io/tags/halcon/>Halcon</a></div></div></header><div class=post-content><h1 id=影像分割>影像分割</h1><h2 id=固定二值化>固定二值化</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3, P4 =&gt; 二值化閥值區間
</span><span style=color:#75715e></span>threshold(GrayImage, DarkArea, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>128</span>)
</code></pre></div><h2 id=直方圖自動二值化>直方圖自動二值化</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3 =&gt; Sigma 高斯運算 平滑算子
</span><span style=color:#75715e></span>auto_threshold(GrayImage, DarkArea, <span style=color:#ae81ff>8.0</span>)
</code></pre></div><blockquote><p>P.S. 可用 <code>gray_histo</code> or <code>gen_region_histo</code> 查看直方圖</p></blockquote><h2 id=自動全局二值化>自動全局二值化</h2><blockquote><p>利用直方圖像素分佈，例如<strong>最大類間方插法</strong>或<strong>平滑直方圖法</strong></p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3 =&gt; 二值化的方法 
</span><span style=color:#75715e>// max_separability 直方圖中最大的可分性分割
</span><span style=color:#75715e>// smooth_histo 平滑直方圖
</span><span style=color:#75715e>// P4 =&gt; 取 亮部 light 還是 暗部 dark
</span><span style=color:#75715e>// P5 =&gt; 輸出 自動二值化使用的閥值
</span><span style=color:#75715e></span>binary_threshold(GrayImage, DarkArea, <span style=color:#960050;background-color:#1e0010>&#39;</span>max_separability<span style=color:#960050;background-color:#1e0010>&#39;</span>, <span style=color:#960050;background-color:#1e0010>&#39;</span>dark<span style=color:#960050;background-color:#1e0010>&#39;</span>, UsedThreshold)
</code></pre></div><h2 id=局部閥值分割法>局部閥值分割法</h2><blockquote><p>適用於無法用單一灰階分割情況，如背景複雜，亮暗不均</p></blockquote><p>步驟</p><ol><li>套用平滑濾波器</li><li>使用<code>dyn_threshold</code> 比較 原始圖像 與 套用平滑濾波器 後的影像差異，將差異大於設定值的點找出來</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3 =&gt; 輸出的閥值區域
</span><span style=color:#75715e>// P4 =&gt; Offset 值，比較後大於該值將被提取出來
</span><span style=color:#75715e>// P5 =&gt; 哪個區域
</span><span style=color:#75715e>// light 原圖 &gt;= 平滑後 + Offset
</span><span style=color:#75715e>// dark 原圖 &lt;= 平滑後 - Offset
</span><span style=color:#75715e>// equal (平滑後 + Offset) &lt; 原圖 &lt; (平滑後 - Offset)
</span><span style=color:#75715e>// not_equal (平滑後 + Offset) &gt;= 原圖 Or 原圖 &gt;= (平滑後 - Offset)
</span><span style=color:#75715e></span>dyn_threshold(Image, ImageMean, RegionDynThresh, <span style=color:#ae81ff>4</span>, <span style=color:#960050;background-color:#1e0010>&#39;</span>not_equal<span style=color:#960050;background-color:#1e0010>&#39;</span>)
</code></pre></div><h2 id=var_threshold>Var_Threshold</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3, P4 =&gt; Mask 長寬
</span><span style=color:#75715e>// P5 =&gt; 標準差因子
</span><span style=color:#75715e>// P6 =&gt; 絕對閥值
</span><span style=color:#75715e>// P7 =&gt; dark, light, equal, not_equal
</span><span style=color:#75715e></span>var_threshold(Image, Region, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>0.2</span>, <span style=color:#ae81ff>35</span>, <span style=color:#960050;background-color:#1e0010>&#39;</span>darkk<span style=color:#960050;background-color:#1e0010>&#39;</span>)
</code></pre></div><h2 id=char_threshold>Char_Threshold</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>char_threshold(Imge, Image, Characters, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>95</span>, Threshold)
</code></pre></div><h2 id=dual_threshold>Dual_Threshold</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp>dual_threshold(Imge, RegionCrossings, MinSize, MinGray, Threshold)
</code></pre></div><h1 id=區域生長法>區域生長法</h1><h2 id=regiongrowing>RegiongRowing</h2><blockquote><p>將灰階相近的像素合併</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// P3, P4 =&gt; 矩形區域長寬 (奇數)
</span><span style=color:#75715e>// P5 =&gt; 灰階差的分割標準
</span><span style=color:#75715e>// P6 =&gt; 輸出區域的最小像素
</span><span style=color:#75715e></span>regiongrowing(Image, Regions, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3.0</span>, <span style=color:#ae81ff>100</span>)
</code></pre></div><hr><h1 id=bayer-rg8-to-halcon>Bayer RG8 to Halcon</h1><h2 id=halcon-cfatorgb>Halcon CfaToRgb</h2><blockquote><p>將單通道彩色，轉換成三通道</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#75715e>// cfa_to_rgb — Convert a single-channel color filter array image into an RGB image.
</span><span style=color:#75715e>// CFAType: &#39;bayer_bg&#39;, &#39;bayer_gb&#39;, &#39;bayer_gr&#39;, &#39;bayer_rg&#39;
</span><span style=color:#75715e>// Interpolation: &#39;bilinear&#39;, &#39;bilinear_dir&#39;, &#39;bilinear_enhanced&#39;
</span><span style=color:#75715e></span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> HOperatorSet.CfaToRgb(HObject CFAImage, <span style=color:#66d9ef>out</span> HObject RGBImage, HTuple CFAType, HTuple interpolation)
</code></pre></div><p><a href=https://www.baslerweb.com/en/sales-support/knowledge-base/frequently-asked-questions/how-can-i-convert-a-pylon-grabresult-into-an-mvtec-halcon-image-buffer/103744/>Basler Grab result to Halcon</a></p><p><a href=http://blog.chinaaet.com/justlxy/p/5100052454>图像Bayer格式介绍以及Bayer插值原理CFA</a></p><p><a href=https://zhuanlan.zhihu.com/p/72581663>图像bayer格式介绍以及bayer插值原理</a></p></div><div class=post-footer></div></article></main></body></html>
<!doctype html><html lang=zh-tw><head><title>AvaloniaUI 踩坑紀錄 // 派翠克技術手札</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Patrick"><meta name=description content="從.Net Framework到.Net，微軟的C#終於可以跨平台，跑在Linux、Docker Container，但是桌面應用程式WinForm、WPF依然只能Windows，然而有個開源項目Avalonia卻是以WPF的風格做出跨平台的桌面應用程式，雖然在各方面都還不構成熟，我們期待它未來的發展。"><link rel=stylesheet href=http://example.org/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css><meta name=twitter:card content="summary"><meta name=twitter:title content="AvaloniaUI 踩坑紀錄"><meta name=twitter:description content="從.Net Framework到.Net，微軟的C#終於可以跨平台，跑在Linux、Docker Container，但是桌面應用程式WinForm、WPF依然只能Windows，然而有個開源項目Avalonia卻是以WPF的風格做出跨平台的桌面應用程式，雖然在各方面都還不構成熟，我們期待它未來的發展。"><meta property="og:title" content="AvaloniaUI 踩坑紀錄"><meta property="og:description" content="從.Net Framework到.Net，微軟的C#終於可以跨平台，跑在Linux、Docker Container，但是桌面應用程式WinForm、WPF依然只能Windows，然而有個開源項目Avalonia卻是以WPF的風格做出跨平台的桌面應用程式，雖然在各方面都還不構成熟，我們期待它未來的發展。"><meta property="og:type" content="article"><meta property="og:url" content="http://example.org/posts/2022-03-21-avaloniaui-first/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-21T19:45:10+08:00"><meta property="article:modified_time" content="2022-03-21T19:45:10+08:00"></head><body><header class=app-header><a href=http://example.org/><img class=app-header-avatar src=/avatar.png alt=Patrick></a><h1>派翠克技術手札</h1><nav class=app-header-menu><a class=app-header-menu-item href=/>首頁</a>
-
<a class=app-header-menu-item href=/tags/>標籤</a>
-
<a class=app-header-menu-item href=/search/>文章搜尋</a></nav><p>這裡是派翠克技術手札</p><div class=app-header-social><a href=https://github.com/patrick85081 target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>AvaloniaUI 踩坑紀錄</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-03-21</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>2 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=http://example.org/tags/avalonia/>Avalonia</a>
<a class=tag href=http://example.org/tags/wpf/>WPF</a>
<a class=tag href=http://example.org/tags/mvvm/>MVVM</a></div></div></header><div class=post-content><h1 id=前言>前言</h1><p>從.Net Framework到.Net，微軟的C#終於可以跨平台，跑在Linux、Docker Container，但是桌面應用程式WinForm、WPF依然只能Windows，然而有個開源項目Avalonia卻是以WPF的風格做出跨平台的桌面應用程式，雖然在各方面都還不構成熟，我們期待它未來的發展。</p><h1 id=環境建置>環境建置</h1><h2 id=dotnet-樣板>Dotnet 樣板</h2><ul><li><p>下載樣板
<a href=https://github.com/AvaloniaUI/avalonia-dotnet-templates>Avalonia Dotnet Template</a></p></li><li><p>安裝樣板</p></li></ul><blockquote><p>dotnet new –install [path-to-repository]</p></blockquote><ul><li>Avalonia 樣板</li></ul><table><thead><tr><th>範本名稱</th><th>簡短名稱</th><th>語言</th><th>標記</th></tr></thead><tbody><tr><td>Avalonia .NET Core App</td><td>avalonia.app</td><td>[C#],F#</td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia .NET Core MVVM App</td><td>avalonia.mvvm</td><td>[C#],F#</td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia UserControl</td><td>avalonia.usercontrol</td><td>[C#],F#</td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia Window</td><td>avalonia.window</td><td>[C#],F#</td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia TemplatedControl</td><td>avalonia.templatedcontrol</td><td>[C#]</td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia Resource Dictionary</td><td>avalonia.resource</td><td></td><td>ui/xaml/avalonia/avaloniaui</td></tr><tr><td>Avalonia Styles</td><td>avalonia.styles</td><td></td><td>ui/xaml/avalonia/avaloniaui</td></tr></tbody></table><ul><li>參考資料
<a href=https://www.lingmin.me/2020/04/30/AvaloniaHelloWorld/>Avalonia Hello World</a></li></ul><h2 id=ide擴充套件>IDE擴充套件</h2><ul><li><p>Visual Studio
<a href="https://marketplace.visualstudio.com/items?itemName=AvaloniaTeam.AvaloniaforVisualStudio">Avalonia for Visual Studio</a></p></li><li><p>JetBrains Rider</p><ol><li>加入 Plugin Repository <code>https://plugins.jetbrains.com/plugins/dev/14839</code></li></ol><p><img src=Rider_Plugin_Repository.png alt></p><ol start=2><li>安裝 AvaloniaRider
<a href=https://plugins.jetbrains.com/plugin/14839-avaloniarider>AvaloniaRider</a></li></ol></li></ul><hr><h1 id=教學文檔>教學文檔</h1><p><a href=https://docs.avaloniaui.net/docs/getting-started/programming-with-avalonia>AvaloniaUI Doc</a></p><p><a href=https://blog.csdn.net/jinyuttt/category_10038673.html>一起學習 Avalonia</a></p><p><a href=https://github.com/AvaloniaCommunity/awesome-avalonia>Avalonia 社群資料整理</a></p><p><a href=https://www.reactiveui.net/docs/getting-started/>ReactiveUI Doc</a></p><p><a href=https://github.com/blackie1019/reactive-progamming-dot-net>reactive progamming dot net</a></p><h1 id=xaml標記xname不能用>XAML標記x:Name不能用</h1><p>開始正常使用後會發現第一個問題，以前在寫WPF時候，幫控制項取變數名稱的<code>x:Name="MyName"</code>，Window內就可直接調用不管用了</p><ul><li>第一種方法 (原生)
可以在 Window/UserControl中使用<code>Find&lt;T>(name)</code>取得</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#66d9ef>this</span>.Find&lt;TextBlock&gt;(<span style=color:#e6db74>&#34;txt&#34;</span>);
</code></pre></div><ul><li>第二種方法
改成使用<code>Source Generator</code>的方式來做，需要另外安裝Nuget包<code>XamlNameReferenceGenerator</code></li></ul><blockquote><p>dotnet add package XamlNameReferenceGenerator</p></blockquote><p>套件GitHub : <a href=https://github.com/AvaloniaUI/Avalonia.NameGenerator>Avalonia.NameGenerator</a></p><ul><li>參考資料
<a href=https://www.bilibili.com/read/cv11136600>Avaloniaui奇怪问题记录之x:Name用不了</a></li></ul><h1 id=messagebox不見了>MessageBox不見了</h1><p>在AvaloniaUI裡面沒有MessageBox，大概是只要自己用Window做一做就好所以就沒內建，5這裡有其他人做的簡易MessageBox</p><blockquote><p>dotnet add package MessageBox.Avalonia</p></blockquote><p>套件GitHub : <a href=https://github.com/AvaloniaCommunity/MessageBox.Avalonia>MessageBox.Avalonia</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#66d9ef>var</span> messageBoxStandardWindow = MessageBox.Avalonia.MessageBoxManager
	.GetMessageBoxStandardWindow(
		<span style=color:#e6db74>&#34;Title&#34;</span>,
		<span style=color:#e6db74>&#34;Show MessageBox Content&#34;</span>);
<span style=color:#66d9ef>await</span> messageBoxStandardWindow.Show(); <span style=color:#75715e>//ShowDialog(windows);
</span></code></pre></div><h1 id=design-datacontext>Design DataContext</h1><p>在 Avalonia 不支援 <code>d:DesignInstance</code>，所以設計時候的DataContext要改寫法</p><p>以前在WPF 可以寫</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;Window</span>
	<span style=color:#a6e22e>d:DataContext=</span><span style=color:#e6db74>&#34;{d:DesignInstance local:MyDesignViewModel, IsDesignTimeCreatable=true}&#34;</span>
	<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/Window&gt;</span>
</code></pre></div><p>在 Avalonia 要寫</p><ul><li>方法一 靜態方式取得，需要事先塞好測試資料</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;Window</span>
	<span style=color:#a6e22e>d:DataContext=</span><span style=color:#e6db74>&#34;{x:static local:MyDesignData.MyViewModel}&#34;</span>
	<span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/Window&gt;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyDesignData</span>
{
	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> MyViewModel MyViewModel =&gt; <span style=color:#66d9ef>new</span> MyViewModel(){ Title = <span style=color:#e6db74>&#34;MyTitle&#34;</span> };
}
</code></pre></div><ul><li>方法二 設計時去產生資料，可在View塞資料</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;Window</span>
	<span style=color:#f92672>&gt;</span>
	<span style=color:#f92672>&lt;Design.DataContext&gt;</span>
		<span style=color:#f92672>&lt;local:DesignViewModel</span> <span style=color:#a6e22e>Title=</span><span style=color:#e6db74>&#34;MyTitle&#34;</span><span style=color:#f92672>/&gt;</span>
	<span style=color:#f92672>&lt;/Design.DataContext&gt;</span>
<span style=color:#f92672>&lt;/Window&gt;</span>
</code></pre></div><h2 id=參考資料>參考資料</h2><ul><li><a href=https://docs.avaloniaui.net/docs/getting-started/ide-support>Design-Time Properties</a></li><li><a href=https://github.com/AvaloniaUI/Avalonia/issues/2445>Add support for d:DesignInstance when using d:DataContext in designer #2445</a></li><li><a href=https://github.com/AvaloniaUI/Avalonia/issues/2121>How to set DataContext in own UserControl? #2121</a></li></ul><hr><h1 id=behavor>Behavor</h1><blockquote><p>dotnet add package Avalonia.Xaml.Behaviors</p></blockquote><p>套件GitHub : <a href=https://github.com/wieslawsoltes/AvaloniaBehaviors>AvaloniaBehaviors</a></p><h3 id=eventtocommand>EventToCommand</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;UserControl</span> <span style=color:#a6e22e>x:Class=</span><span style=color:#e6db74>&#34;BehaviorsTestApplication.Views.Pages.EventTriggerBehaviorView&#34;</span>
             <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;https://github.com/avaloniaui&#34;</span>
             <span style=color:#a6e22e>xmlns:x=</span><span style=color:#e6db74>&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34;</span>
             <span style=color:#a6e22e>xmlns:i=</span><span style=color:#e6db74>&#34;using:Avalonia.Xaml.Interactivity&#34;</span>
             <span style=color:#a6e22e>xmlns:ia=</span><span style=color:#e6db74>&#34;using:Avalonia.Xaml.Interactions.Core&#34;</span>
             <span style=color:#a6e22e>xmlns:d=</span><span style=color:#e6db74>&#34;http://schemas.microsoft.com/expression/blend/2008&#34;</span>
             <span style=color:#a6e22e>xmlns:mc=</span><span style=color:#e6db74>&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34;</span>
             <span style=color:#a6e22e>xmlns:vm=</span><span style=color:#e6db74>&#34;using:BehaviorsTestApplication.ViewModels&#34;</span>
             <span style=color:#a6e22e>x:CompileBindings=</span><span style=color:#e6db74>&#34;True&#34;</span> <span style=color:#a6e22e>x:DataType=</span><span style=color:#e6db74>&#34;vm:MainWindowViewModel&#34;</span>
             <span style=color:#a6e22e>mc:Ignorable=</span><span style=color:#e6db74>&#34;d&#34;</span> <span style=color:#a6e22e>d:DesignWidth=</span><span style=color:#e6db74>&#34;600&#34;</span> <span style=color:#a6e22e>d:DesignHeight=</span><span style=color:#e6db74>&#34;450&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;Design.DataContext&gt;</span>
    <span style=color:#f92672>&lt;vm:MainWindowViewModel</span> <span style=color:#f92672>/&gt;</span>
  <span style=color:#f92672>&lt;/Design.DataContext&gt;</span>
  <span style=color:#f92672>&lt;Grid</span> <span style=color:#a6e22e>RowDefinitions=</span><span style=color:#e6db74>&#34;Auto,Auto&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;TextBox</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;TextBox&#34;</span> <span style=color:#a6e22e>Text=</span><span style=color:#e6db74>&#34;Hello&#34;</span> <span style=color:#a6e22e>Grid.Row=</span><span style=color:#e6db74>&#34;0&#34;</span> <span style=color:#a6e22e>Margin=</span><span style=color:#e6db74>&#34;5&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;Button</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;ChangeProperty&#34;</span> <span style=color:#a6e22e>Content=</span><span style=color:#e6db74>&#34;Change Property&#34;</span> <span style=color:#a6e22e>Grid.Row=</span><span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#a6e22e>Margin=</span><span style=color:#e6db74>&#34;5,0,5,5&#34;</span><span style=color:#f92672>&gt;</span>
      <span style=color:#f92672>&lt;i:Interaction.Behaviors&gt;</span>
        <span style=color:#f92672>&lt;ia:EventTriggerBehavior</span> <span style=color:#a6e22e>EventName=</span><span style=color:#e6db74>&#34;Click&#34;</span> <span style=color:#a6e22e>SourceObject=</span><span style=color:#e6db74>&#34;{Binding #ChangeProperty}&#34;</span><span style=color:#f92672>&gt;</span>
          <span style=color:#f92672>&lt;ia:ChangePropertyAction</span> <span style=color:#a6e22e>TargetObject=</span><span style=color:#e6db74>&#34;{Binding #TextBox}&#34;</span> <span style=color:#a6e22e>PropertyName=</span><span style=color:#e6db74>&#34;Text&#34;</span> <span style=color:#a6e22e>Value=</span><span style=color:#e6db74>&#34;World&#34;</span> <span style=color:#f92672>/&gt;</span>
		  <span style=color:#f92672>&lt;ia:InvokeCommandAction</span> <span style=color:#a6e22e>Command=</span><span style=color:#e6db74>&#34;{Binding MyCommand}&#34;</span> <span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;/ia:EventTriggerBehavior&gt;</span>
      <span style=color:#f92672>&lt;/i:Interaction.Behaviors&gt;</span>
    <span style=color:#f92672>&lt;/Button&gt;</span>
  <span style=color:#f92672>&lt;/Grid&gt;</span>
<span style=color:#f92672>&lt;/UserControl&gt;</span>
</code></pre></div><hr><h1 id=di>DI</h1><p><a href=https://github.com/reactiveui/splat>ReactiveUI Splat</a></p><h2 id=替換其他-di>替換其他 DI</h2><ul><li>Autofac</li></ul><blockquote><p>dotnet add package Splat.Autofac</p></blockquote><p>來源：<a href=https://www.nuget.org/packages/Splat.Autofac/>Splat.Autofac</a></p><ul><li>DryIoc</li></ul><blockquote><p>dotnet add package Splat.DryIoc</p></blockquote><p>來源：<a href=https://www.nuget.org/packages/Splat.DryIoc/>Splat.DryIoc</a></p><ul><li>Microsoft.Extensions.DependencyInjection</li></ul><blockquote><p>dotnet add Splat.Microsoft.Extensions.DependencyInjection</p></blockquote><p>來源：<a href=https://www.nuget.org/packages/Splat.Microsoft.Extensions.DependencyInjection/>Splat.Microsoft.Extensions.DependencyInjection</a></p><ul><li>Ninject</li></ul><blockquote><p>dotnet add package Splat.Ninject</p></blockquote><p>來源：<a href=https://www.nuget.org/packages/Splat.Ninject/>Splat.Ninject</a></p><ul><li>SimpleInjector</li></ul><blockquote><p>dotnet add package Splat.SimpleInjector</p></blockquote><p>來源：<a href=https://www.nuget.org/packages/Splat.SimpleInjector/>Splat.SimpleInjector</a></p><h2 id=更換di後的注意事項>更換DI後的注意事項</h2><p><a href=https://github.com/AvaloniaUI/Avalonia/issues/5298>When you replace dependency injection with autofac, showdialog will report an error</a></p><hr><h1 id=reactiveui-route>ReactiveUI Route</h1><p>skip</p><hr><h1 id=ui-live-reload>UI Live Reload</h1><p>如果要達到 .Net 6 一樣的 Live Reload，可以透過這個涵式庫，基本上是重用ViewModel，但是UI重新產生。<br><a href=https://github.com/AvaloniaCommunity/Live.Avalonia>Live.Avalonia</a></p><h1 id=現成ui主題套件>現成UI主題套件</h1><ul><li><a href=https://github.com/AvaloniaCommunity/Material.Avalonia>Material.Avalonia</a>
<img src=https://github.com/AvaloniaCommunity/Material.Avalonia/raw/dev/wiki/images/demo-screenshots/1.png alt></li><li><a href=https://github.com/AvaloniaCommunity/Citrus.Avalonia>Citrus.Avalonia</a>
<img src=https://github.com/AvaloniaCommunity/Citrus.Avalonia/raw/main/assets/picture.jpeg alt></li><li><a href=https://github.com/fsprojects/Avalonia.FuncUI>Avalonia.FuncUI</a>
<img src=https://github.com/fsprojects/Avalonia.FuncUI/raw/master/github/img/hero.png alt></li></ul><h1 id=ui控制項套件>UI控制項套件</h1><ul><li><a href=https://github.com/AvaloniaCommunity/Avalonia.Microcharts>Avalonia.Microcharts</a>
<img src=https://github.com/AvaloniaCommunity/Avalonia.Microcharts/raw/master/github/img/charts.png alt="Avalonia.Microcharts Snapshot"></li></ul></div><div class=post-footer></div></article></main></body></html>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>SQL on 派翠克技術手札</title><link>https://patrick85081.github.io/tags/sql/</link><description>Recent content in SQL on 派翠克技術手札</description><generator>Hugo -- gohugo.io</generator><language>zh-TW</language><lastBuildDate>Fri, 15 Jul 2022 10:10:34 +0800</lastBuildDate><atom:link href="https://patrick85081.github.io/tags/sql/index.xml" rel="self" type="application/rss+xml"/><item><title>SQL 進行 字串串接</title><link>https://patrick85081.github.io/posts/2022-07-15-sql-string-join/</link><pubDate>Fri, 15 Jul 2022 10:10:34 +0800</pubDate><guid>https://patrick85081.github.io/posts/2022-07-15-sql-string-join/</guid><description>在 C# 裡面要做字串串接 string.Join() 非常容易，但是如果要在SQL裡面進行呢？這裡花了一些時間研究，主要使用XML的方式來做。
Case 1: 可以支援到 Sql 2014 原始資料 MAC SiteId NicVendorId HostName 001122334455 0 3 Win7 001122334455 1 4 Win10 SELECT DISTINCT M.Mac, STUFF( (SELECT &amp;#39;,&amp;#39; + CONVERT(varchar, inner.SiteId) FROM MacAddresses inner WHERE inner.Mac = M.Mac FOR XML PATH(&amp;#39;&amp;#39;) ), 1, 1, &amp;#39;&amp;#39;) as &amp;#39;SiteId&amp;#39;, STUFF( (SELECT &amp;#39;,&amp;#39; + CONVERT(varchar, inner.NicVendorId) FROM MacAddresses inner WHERE inner.</description></item><item><title>SQL 批次刪除，資料轉型失敗問題</title><link>https://patrick85081.github.io/posts/2022-03-29-entityframework-batch-delete-cast-not-valid/</link><pubDate>Wed, 30 Mar 2022 13:12:45 +0800</pubDate><guid>https://patrick85081.github.io/posts/2022-03-29-entityframework-batch-delete-cast-not-valid/</guid><description>原由 最近碰到一個有去的錯誤，當透過EntityFrameworkPlus 做資料庫資料批次刪除，結果卻回傳InvalidCastException，但是卻只有這個DB才有此問題，這問題真叫人苦惱。
原程式很單純，大致上如下：
dataContext.Employees .Where(e =&amp;gt; e.Year &amp;gt; 30) .Delete(); 結果 結果發現因之前有資料庫除錯上需求，在該資料表加入 Delete Trigger，應該要 Insert 刪除記錄到另一張表，卻寫成資料 Select。
陰錯陽差之下在 Entity Framework Plus 下達刪除命令後，會去抓資料庫回傳的影響資料筆數，卻抓到 Trigger 產生出來的資料，造成使用該資料的第一個Row第一個Column資料，轉型成 影響筆數 （Int32） 才出的錯誤，結案。</description></item></channel></rss>